# 登录状态管理升级指南

## 新功能概述

系统已升级登录状态管理机制，现在支持两种模式：

1. **记住我模式**：用户选择"记住我"后，登录状态会持久保存，下次启动应用会自动恢复登录状态
2. **会话模式**：用户不选择"记住我"，登录状态只在当前浏览器会话中有效，关闭浏览器或刷新页面后需要重新登录

## 功能特性

### 1. 登录界面升级
- ✅ 所有登录表单（用户、维修人员、管理员）都新增了"记住我"复选框
- ✅ 用户可以选择是否记住登录状态
- ✅ 界面美观，用户体验良好

### 2. 智能存储机制
- **记住我开启**：使用 `localStorage` 持久化存储用户信息
- **记住我关闭**：使用 `sessionStorage` 会话存储，关闭浏览器后自动清除

### 3. 安全性提升
- ✅ 用户主动选择是否记住登录状态
- ✅ 会话模式下，关闭浏览器自动清除登录信息
- ✅ 退出登录会清除所有存储的登录信息

## 使用说明

### 对于想要每次启动都登录的用户
1. 登录时**不要**勾选"记住我"复选框
2. 关闭浏览器或刷新页面后需要重新登录
3. 这样可以确保安全性，特别适合公共电脑使用

### 对于想要保持登录状态的用户
1. 登录时勾选"记住我"复选框
2. 下次打开浏览器时会自动恢复登录状态
3. 适合个人设备使用

## 技术实现

### 存储策略
```javascript
// 记住我模式 - 持久化存储
localStorage.setItem('user', JSON.stringify(userData))
localStorage.setItem('userRole', role)
localStorage.setItem('rememberMe', 'true')

// 会话模式 - 会话存储
sessionStorage.setItem('user', JSON.stringify(userData))
sessionStorage.setItem('userRole', role)
```

### 状态检查逻辑
```javascript
const checkAuth = () => {
  // 优先检查持久化存储
  const storedUser = localStorage.getItem('user')
  const rememberMe = localStorage.getItem('rememberMe')
  
  if (storedUser && rememberMe === 'true') {
    // 恢复持久化状态
    return restoreFromLocalStorage()
  }
  
  // 检查会话存储
  const sessionUser = sessionStorage.getItem('user')
  if (sessionUser) {
    // 恢复会话状态
    return restoreFromSessionStorage()
  }
}
```

## 测试场景

### 场景1：记住我功能测试
1. 打开登录页面
2. 输入正确的用户名和密码
3. **勾选"记住我"复选框**
4. 点击登录
5. 成功登录后，关闭浏览器
6. 重新打开浏览器，访问应用
7. **预期结果**：自动恢复到登录状态，无需重新登录

### 场景2：会话模式测试
1. 打开登录页面
2. 输入正确的用户名和密码
3. **不勾选"记住我"复选框**
4. 点击登录
5. 成功登录后，关闭浏览器
6. 重新打开浏览器，访问应用
7. **预期结果**：回到登录页面，需要重新登录

### 场景3：退出登录测试
1. 在任意状态下登录系统
2. 点击"退出登录"
3. **预期结果**：清除所有登录信息，回到登录页面
4. 刷新页面或重新打开浏览器
5. **预期结果**：仍然在登录页面，无论之前是否选择了"记住我"

### 场景4：多角色测试
1. 分别测试用户、维修人员、管理员三种角色
2. 确保每种角色的"记住我"功能都正常工作
3. 确保角色切换时状态管理正确

## 开发者说明

### 修改的文件
1. `src/views/Login.vue` - 添加"记住我"复选框和相关逻辑
2. `src/stores/auth.js` - 升级认证状态管理机制
3. `src/App.vue` - 保持原有的状态检查逻辑

### API 变更
```javascript
// 原来的登录方法
await authStore.login(credentials, role)

// 新的登录方法
await authStore.login(credentials, role, rememberMe)
```

### 兼容性
- ✅ 向后兼容，现有的登录流程不受影响
- ✅ 默认行为：不勾选"记住我"时使用会话模式
- ✅ 所有现有功能保持不变

## 常见问题

### Q: 如何强制用户每次都重新登录？
A: 管理员可以在部署时设置环境变量或修改代码，强制禁用"记住我"功能。

### Q: 用户忘记自己选择了什么模式怎么办？
A: 用户可以随时点击"退出登录"清除所有状态，然后重新选择合适的登录模式。

### Q: 为什么刷新页面后有时需要重新登录？
A: 这是正常行为。如果用户没有选择"记住我"，系统使用会话存储，刷新页面会清除登录状态。

### Q: 如何检查当前使用的是哪种存储模式？
A: 打开浏览器开发者工具 -> Application -> Storage，查看 localStorage 和 sessionStorage 中的数据。

## 安全建议

1. **公共电脑**：建议用户不要勾选"记住我"
2. **个人设备**：可以勾选"记住我"提升使用体验
3. **定期清理**：建议用户定期清理浏览器数据
4. **及时退出**：使用完毕后及时点击"退出登录"

## 更新日志

### v2.0.0 (当前版本)
- ✅ 新增"记住我"功能
- ✅ 支持会话存储和持久化存储两种模式
- ✅ 优化用户体验和安全性
- ✅ 保持向后兼容性

### v1.0.0 (原版本)
- 仅支持持久化存储
- 用户无法选择登录模式
